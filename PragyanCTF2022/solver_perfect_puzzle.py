#! python3
from Crypto.Util.number import *

CipherText=149596971555589076155364186420580570749374401138608961998290009825114263148416772478651277321234724062278466223025831775035224109103887370927097231230324908201908263749968832767737017862796581877535194538767636598004538397685647433625803605580636107271455294998120570215920206140799513104969815764397323782297061528436771406170006449117531288516762624306954764709977440515034071280736026924741057203047657693649914954727759355179977253548864147305088480009948437
Alice=282107567413424138126415916172126379762973487029431335677677351999909735485304760228208386658075380503123901137419658654328175448732740174233462536318627304974901304879611754592414594362308597516549359004265409028150117237817823179344527892839743549388806946124113890322466683297081312475367783738162570544520549179569150033008482592884468354854459703961697842606812
Bob=66444211849564598649204285138638077348678558382508976397654912859551087895603398701542655997585482323573895063934558694018052442406995794312376093987279068684491709029458439225825559371474422839752950009253788191772668126664288610488535211383255806288769703027437108720296265682565379886651381942112538908474625781728851722312089113677698489150478927871052981645551018211694817730263647445568601019977068831413100897642519594589716447525199022801203505747758062305119871983246399979915166157
Result=2.0 # some of 1/divs == 2 ==> maybe perfect number

# Xemu bit len ~= 607
# q bit len ~= 1024

# https://math.dartmouth.edu/~jvoight/notes/perfelem.pdf
# Theorem 9 (Euler). If N is an even perfect number, then N can be written in the form N = 2^n−1*(2^n − 1), where 2^n − 1 is prime. ==> mersenne prime
for i in range(2, 1024):
	p = 2**i -1

	if Bob % p == 0:
		n = i
		break
		

Xemu = 2**n - 1
assert Bob % Xemu == 0

q = Bob // Xemu
p = Alice - Xemu ** 2
assert isPrime(p) and isPrime(q)
n = p*q
e = 65537

d = inverse(e, (p-1)*(q-1))
m = pow(CipherText, d, n)
print(long_to_bytes(m))
# p_ctf{M3rs5nne_pr1mes_4re_c00l}
